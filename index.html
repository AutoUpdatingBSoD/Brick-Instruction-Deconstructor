<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<input type="file" id="imageUpload" multiple>
<div id="testlog"></div>
<script>
const testlog = document.getElementById("testlog");
const categories = ['bagset', 'dontreadrepeat', 'finish', 'index', 'pageno', 'part', 'partstep', 'repeat', 'splitdecision', 'subbuild'];

async function setupBackend() {
    await tf.setBackend('webgl');
    console.log(`Using backend: ${tf.getBackend()}`);
}
setupBackend();

async function loadImage(url) {
    return new Promise((resolve) => {
        const img = new Image();
        img.crossOrigin = "anonymous";
        img.src = url;
        img.onload = () => resolve(img);
    });
}

async function processImage(img, expand = false) {
    return tf.tidy(() => {
        let tensor = tf.browser.fromPixels(img)
            .resizeNearestNeighbor([96, 96])
            .toFloat()
            .div(255)
            .cast('float16');
        return expand ? tensor.expandDims() : tensor;
    });
}

const model = tf.sequential();
